<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pay - DemoShop</title>

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="114x114" href="https://design.swedbankpay.com/v/8.0.1/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="https://design.swedbankpay.com/v/8.0.1/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="https://design.swedbankpay.com/v/8.0.1/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="https://design.swedbankpay.com/v/8.0.1/icons/apple-touch-icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="https://design.swedbankpay.com/v/8.0.1/icons/apple-touch-icon-180x180.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="https://design.swedbankpay.com/v/8.0.1/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="https://design.swedbankpay.com/v/8.0.1/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="https://design.swedbankpay.com/v/8.0.1/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="https://design.swedbankpay.com/v/8.0.1/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)" href="https://design.swedbankpay.com/v/8.0.1/icons/apple-touch-startup-image-320x460.png" />
    <link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)" href="https://design.swedbankpay.com/v/8.0.1/icons/apple-touch-startup-image-640x920.png" />
    <link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" href="https://design.swedbankpay.com/v/8.0.1/icons/apple-touch-startup-image-640x1096.png" />
    <link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" href="https://design.swedbankpay.com/v/8.0.1/icons/apple-touch-startup-image-750x1294.png" />
    <link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 3)" href="https://design.swedbankpay.com/v/8.0.1/icons/apple-touch-startup-image-1182x2208.png" />
    <link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 3)" href="https://design.swedbankpay.com/v/8.0.1/icons/apple-touch-startup-image-1242x2148.png" />
    <link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 1)" href="https://design.swedbankpay.com/v/8.0.1/icons/apple-touch-startup-image-748x1024.png" />
    <link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)" href="https://design.swedbankpay.com/v/8.0.1/icons/apple-touch-startup-image-1496x2048.png" />
    <link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 1)" href="https://design.swedbankpay.com/v/8.0.1/icons/apple-touch-startup-image-768x1004.png" />
    <link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)" href="https://design.swedbankpay.com/v/8.0.1/icons/apple-touch-startup-image-1536x2008.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="https://design.swedbankpay.com/v/8.0.1/icons/favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="https://design.swedbankpay.com/v/8.0.1/icons/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="48x48" href="https://design.swedbankpay.com/v/8.0.1/icons/favicon-48x48.png" />
    <link rel="manifest" href="https://design.swedbankpay.com/v/8.0.1//icons/manifest.json" />
    <link rel="shortcut icon" href="https://design.swedbankpay.com/v/8.0.1//icons/favicon.ico" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Swedbank Pay App" />
    <meta name="application-name" content="Swedbank Pay App" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="msapplication-TileColor" content="#000" />
    <meta name="msapplication-TileImage" content="https://design.swedbankpay.com/v/8.0.1/icons/mstile-144x144.png" />
    <meta name="msapplication-config" content="https://design.swedbankpay.com/v/8.0.1/icons/browserconfig.xml" />
    <meta name="theme-color" content="#000" />
    
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <style>
        .checkin iframe {
            height: 1000px;
            padding-bottom: 16px;
        }
    </style>
    <link rel="stylesheet" href="https://design.swedbankpay.com/v/8.0.1/styles/swedbankpay.css" />
    <script src="<%= view_checkout %>"></script>

</head>
<body>
    <div class="container">
        <div class="mt-5"></div>
        <div class="steps">
            <ol>
                <li id="step1" class="steps-ongoing steps-selected">
                    <div class="steps-number">1</div>
                    Step one
                    <div class="steps-sub-title">Date</div>
                </li>
                <li id="step2" class="">
                    <div class="steps-number">2</div>Step two
                </li>
                <li id="step3" >
                    <div class="steps-number">3</div>Step three
                </li>
                <li id="step4" >
                    <div class="material-icons steps-icon">check</div>Finished
                </li>
            </ol>
            <div class="steps-responsive">
                <div class="steps-responsive-text">Step 1</div>
            </div>
        </div>


        <div class="row justify-content-center">
            <div class="col-6">
                <div class="form-group">
                    <label for="init-value-datepicker">Select Shipment date</label>
                    <div class="input-group">
                        <span class="input-group-addon "><i class="material-icons material-icons-outlined" aria-hidden="true">event</i></span>
                        <input id="date" type="text" id="init-value-datepicker" class="form-control" data-datepicker data-datepicker-value="2022-03-15" data-datepicker-fulldate="true" required/>
                    </div>
                    <br>
                    <button id="checkdata_submit" onclick="checkdate()" class="btn btn-primary" type="button">Submit</button>

                </div>
            </div>
        </div>
        <div class="row justify-content-center">
            <div id="checkin_class" class="col-md-4 md-push-4">
                <div id="checkin" class="checkin"></div>
                
            </div>
            <div id="paymentmenu_class" style="display: none" class="col-md-4 md-push-4">
                <div id="paymentMenu"></div>

            </div>
        </div>
    </div>
    
    <!--<div id="checkout-container"></div>-->
    <!-- Here you can specify your own javascript file -->
    <script src="https://design.swedbankpay.com/v/8.0.1/scripts/dg.js" global="true" autoload="true"></script>

    <script>
        //runpayment()

        function checkdate(){
            document.cookie = "date=" + document.getElementById("date").value;
            document.getElementById("step1").className = "steps-completed";
            document.getElementById("step1").innerHTML = `<div class="material-icons steps-icon">check</div>
            Step one
            <div class="steps-sub-title">Date Range</div>`;
            document.getElementById("step2").className = "steps-ongoing steps-selected";
            document.getElementById("checkin_class").className = "col-md-6 md-push-6";
            document.getElementById("checkdata_submit").style.display = "none"
            runpayment()
        }


        async function runpayment() {
            var identified = false
            var resized = 0
            window.payex.hostedView.checkout({
                container: {
                    checkin: "checkin",
                    paymentMenu: "paymentMenu",
                },
                culture: 'nb-No',

                

                // If payer is identified
                onPayerIdentified: async function onPayerIdentified(payerIdentified) {
                    console.log(payerIdentified.payer);
                    console.log("LOGGED IN!")
                    identified = true
                    openPaymentMenu()
                },

                // If payer chooses "Not you?"
                onPayerUnidentified: function onPayerUnidentified(payerUnidentified) {
                    console.log(payerUnidentified);
                },
                onEventNotification: function onEventNotification(eventNotification) {
                    console.log(eventNotification);
                    console.log(identified)
                    if(eventNotification.sourceEvent === "OnCheckoutResized"){
                        resized = resized + 1
                        if(identified === true){
                            console.log(resized)
                            //if(resized + 1 > 5){
                                ///openPaymentMenu()
                            //}
                            
                        }
                    }
                },
                
            }).open("checkin");

        }
        

        async function openPaymentMenu() {
            document.getElementById("step2").className = "steps-completed";
            document.getElementById("step2").innerHTML = `<div class="material-icons steps-icon">check</div>
            Step two
            <div class="steps-sub-title">Authentication</div>`;
            document.getElementById("step3").className = "steps-ongoing steps-selected";

            document.getElementById("checkin_class").className = "col-md-4 md-push-6";
            document.getElementById("paymentmenu_class").style.display = "block";
            window.payex.hostedView.checkout({
                container: {
                    checkin: "checkin",
                    paymentMenu: "paymentMenu",
                },
                culture: 'nb-No',
            }).open("paymentmenu");
            document.cookie = "payment_id=<%= payment_id %>";
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

</body>
</html>