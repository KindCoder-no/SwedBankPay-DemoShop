<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pay - DemoShop</title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <style>
        .checkin iframe {
            height: 1000px;
            padding-bottom: 16px;
        }
    </style>
    <link rel="stylesheet" href="https://design.swedbankpay.com/v/8.0.1/styles/swedbankpay.css" />
    <script src="<%= view_checkout %>"></script>

</head>
<body>
    <div class="container">
        <div class="mt-5"></div>
        <div class="steps">
            <ol>
                <li id="step1" class="steps-ongoing steps-selected">
                    <div class="steps-number">1</div>
                    Step one
                    <div class="steps-sub-title">Date</div>
                </li>
                <li id="step2" class="">
                    <div class="steps-number">2</div>Step two
                </li>
                <li id="step3" >
                    <div class="steps-number">3</div>Step three
                </li>
                <li id="step4" >
                    <div class="steps-number">4</div>Step four
                </li>
            </ol>
            <div class="steps-responsive">
                <div class="steps-responsive-text">Step 1</div>
            </div>
        </div>


        <div class="row justify-content-center">
            <div class="col-6">
                <div class="form-group">
                    <label for="init-value-datepicker">Select Shipment date</label>
                    <div class="input-group">
                        <span class="input-group-addon "><i class="material-icons material-icons-outlined" aria-hidden="true">event</i></span>
                        <input id="date" type="text" id="init-value-datepicker" class="form-control" data-datepicker data-datepicker-value="new Date()" data-datepicker-fulldate="true" />
                    </div>
                    <button onclick="checkdate()" class="btn btn-primary" type="button">Submit</button>

                </div>
            </div>
        </div>
        <div class="row justify-content-center">
            <div id="checkin_class" class="col-md-4 md-push-4">
                <div id="checkin" class="checkin"></div>
                
            </div>
            <div id="paymentmenu_class" style="display: none" class="col-md-4 md-push-4">
                <div id="paymentMenu"></div>

            </div>
        </div>
    </div>
    
    <!--<div id="checkout-container"></div>-->
    <!-- Here you can specify your own javascript file -->
    <script src="https://design.swedbankpay.com/v/8.0.1/scripts/dg.js" global="true" autoload="true"></script>

    <script>
        //runpayment()

        function checkdate(){
            document.cookie = "date=" + document.getElementById("date").value;
            document.getElementById("step1").className = "steps-completed";
            document.getElementById("step1").innerHTML = `<div class="material-icons steps-icon">check</div>
            Step one
            <div class="steps-sub-title">Date Range</div>`;
            document.getElementById("step2").className = "steps-ongoing steps-selected";
            document.getElementById("checkin_class").className = "col-md-6 md-push-6";
            runpayment()
        }


        async function runpayment() {
            var identified = false
            var resized = 0
            window.payex.hostedView.checkout({
                container: {
                    checkin: "checkin",
                    paymentMenu: "paymentMenu",
                },
                culture: 'nb-No',

                

                // If payer is identified
                onPayerIdentified: async function onPayerIdentified(payerIdentified) {
                    console.log(payerIdentified);
                    console.log("LOGGED IN!")
                    identified = true
                    openPaymentMenu()
                },

                // If payer chooses "Not you?"
                onPayerUnidentified: function onPayerUnidentified(payerUnidentified) {
                    console.log(payerUnidentified);
                },
                onEventNotification: function onEventNotification(eventNotification) {
                    console.log(eventNotification);
                    console.log(identified)
                    if(eventNotification.sourceEvent === "OnCheckoutResized"){
                        resized = resized + 1
                        if(identified === true){
                            console.log(resized)
                            //if(resized + 1 > 5){
                                ///openPaymentMenu()
                            //}
                            
                        }
                    }
                },
                
            }).open("checkin");

        }
        

        async function openPaymentMenu() {
            document.getElementById("step2").className = "steps-completed";
            document.getElementById("step2").innerHTML = `<div class="material-icons steps-icon">check</div>
            Step two
            <div class="steps-sub-title">Authentication</div>`;
            document.getElementById("step3").className = "steps-ongoing steps-selected";

            document.getElementById("checkin_class").className = "col-md-4 md-push-6";
            document.getElementById("paymentmenu_class").style.display = "block";
            window.payex.hostedView.checkout({
                container: {
                    checkin: "checkin",
                    paymentMenu: "paymentMenu",
                },
                culture: 'nb-No',
            }).open("paymentmenu");
            document.cookie = "payment_id=<%= payment_id %>";
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

</body>
</html>